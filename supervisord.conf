[supervisord]
nodaemon=true
logfile=/var/log/supervisord.log

[program:nginx]
command=/usr/sbin/nginx -g "daemon off;"
autorestart=true
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr

[program:flask]
command=python3 /app/app.py
directory=/app
autorestart=true
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr

[program:ffmpeg]
command=/bin/sh -c "if [ ! -f /app/inputs.txt ]; then echo 'No inputs yet - waiting for Start Channel' > /app/inputs.txt; fi; /bin/sh /app/ffmpeg.sh"
directory=/app
autorestart=true    # Restart if ffmpeg exits (e.g., no inputs yet)
startsecs=10
stdout_logfile=/var/log/ffmpeg/stdout.log
stderr_logfile=/var/log/ffmpeg/stderr.log
